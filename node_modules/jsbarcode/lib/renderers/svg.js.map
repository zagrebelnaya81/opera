{"version":3,"sources":["../../src/renderers/svg.js"],"names":["svgns","renderer","svg","encodings","options","doc","xmlDocument","document","currentX","marginLeft","prepareSVG","i","length","encoding","encodingOptions","group","createGroup","marginTop","setGroupOptions","drawSvgBarcode","drawSVGText","width","firstChild","removeChild","totalWidth","maxHeight","marginRight","setSvgAttributes","background","drawRect","setAttribute","parent","binary","data","yFrom","textPosition","fontSize","textMargin","barWidth","x","b","barcodePadding","height","textElem","createElementNS","displayValue","y","fontOptions","font","textAlign","appendChild","createTextNode","text","lineColor","rect"],"mappings":"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","sourcesContent":["import { calculateEncodingAttributes, getTotalWidthOfEncodings, getMaximumHeightOfEncodings } from './shared.js';\n\nvar svgns = 'http://www.w3.org/2000/svg';\n\nfunction renderer(svg, encodings, options) {\n\tconst doc = options.xmlDocument || document;\n\n\tvar currentX = options.marginLeft;\n\n\tprepareSVG();\n\tfor (let i = 0; i < encodings.length; i++) {\n\t\tvar encoding = encodings[i];\n\t\tvar encodingOptions = { ...options, ...encoding.options };\n\n\t\tvar group = createGroup(currentX, encodingOptions.marginTop, svg);\n\n\t\tsetGroupOptions(group, encodingOptions);\n\n\t\tdrawSvgBarcode(group, encodingOptions, encoding);\n\t\tdrawSVGText(group, encodingOptions, encoding);\n\n\t\tcurrentX += encoding.width;\n\t}\n\n\tfunction prepareSVG() {\n\t\t// Clear the SVG\n\t\twhile (svg.firstChild) {\n\t\t\tsvg.removeChild(svg.firstChild);\n\t\t}\n\n\t\tcalculateEncodingAttributes(encodings, options);\n\t\tvar totalWidth = getTotalWidthOfEncodings(encodings);\n\t\tvar maxHeight = getMaximumHeightOfEncodings(encodings);\n\n\t\tvar width = totalWidth + options.marginLeft + options.marginRight;\n\t\tsetSvgAttributes(width, maxHeight);\n\n\t\tif (options.background) {\n\t\t\tdrawRect(0, 0, width, maxHeight, svg).setAttribute('style', 'fill:' + options.background + ';');\n\t\t}\n\t}\n\n\tfunction drawSvgBarcode(parent, options, encoding) {\n\t\tvar binary = encoding.data;\n\n\t\t// Creates the barcode out of the encoded binary\n\t\tvar yFrom;\n\t\tif (options.textPosition == 'top') {\n\t\t\tyFrom = options.fontSize + options.textMargin;\n\t\t} else {\n\t\t\tyFrom = 0;\n\t\t}\n\n\t\tvar barWidth = 0;\n\t\tvar x = 0;\n\t\tfor (var b = 0; b < binary.length; b++) {\n\t\t\tx = b * options.width + encoding.barcodePadding;\n\n\t\t\tif (binary[b] === '1') {\n\t\t\t\tbarWidth++;\n\t\t\t} else if (barWidth > 0) {\n\t\t\t\tdrawRect(x - options.width * barWidth, yFrom, options.width * barWidth, options.height, parent);\n\t\t\t\tbarWidth = 0;\n\t\t\t}\n\t\t}\n\n\t\t// Last draw is needed since the barcode ends with 1\n\t\tif (barWidth > 0) {\n\t\t\tdrawRect(x - options.width * (barWidth - 1), yFrom, options.width * barWidth, options.height, parent);\n\t\t}\n\t}\n\n\tfunction drawSVGText(parent, options, encoding) {\n\t\tvar textElem = doc.createElementNS(svgns, 'text');\n\n\t\t// Draw the text if displayValue is set\n\t\tif (options.displayValue) {\n\t\t\tvar x, y;\n\n\t\t\ttextElem.setAttribute('style', 'font:' + options.fontOptions + ' ' + options.fontSize + 'px ' + options.font);\n\n\t\t\tif (options.textPosition == 'top') {\n\t\t\t\ty = options.fontSize - options.textMargin;\n\t\t\t} else {\n\t\t\t\ty = options.height + options.textMargin + options.fontSize;\n\t\t\t}\n\n\t\t\t// Draw the text in the correct X depending on the textAlign option\n\t\t\tif (options.textAlign == 'left' || encoding.barcodePadding > 0) {\n\t\t\t\tx = 0;\n\t\t\t\ttextElem.setAttribute('text-anchor', 'start');\n\t\t\t} else if (options.textAlign == 'right') {\n\t\t\t\tx = encoding.width - 1;\n\t\t\t\ttextElem.setAttribute('text-anchor', 'end');\n\t\t\t}\n\t\t\t// In all other cases, center the text\n\t\t\telse {\n\t\t\t\tx = encoding.width / 2;\n\t\t\t\ttextElem.setAttribute('text-anchor', 'middle');\n\t\t\t}\n\n\t\t\ttextElem.setAttribute('x', x);\n\t\t\ttextElem.setAttribute('y', y);\n\n\t\t\ttextElem.appendChild(doc.createTextNode(encoding.text));\n\n\t\t\tparent.appendChild(textElem);\n\t\t}\n\t}\n\n\tfunction setSvgAttributes(width, height) {\n\t\tsvg.setAttribute('width', width + 'px');\n\t\tsvg.setAttribute('height', height + 'px');\n\t\tsvg.setAttribute('x', '0px');\n\t\tsvg.setAttribute('y', '0px');\n\t\tsvg.setAttribute('viewBox', '0 0 ' + width + ' ' + height);\n\n\t\tsvg.setAttribute('xmlns', svgns);\n\t\tsvg.setAttribute('version', '1.1');\n\n\t\tsvg.setAttribute('style', 'transform: translate(0,0)');\n\t}\n\n\tfunction createGroup(x, y, parent) {\n\t\tvar group = doc.createElementNS(svgns, 'g');\n\t\tgroup.setAttribute('transform', 'translate(' + x + ', ' + y + ')');\n\n\t\tparent.appendChild(group);\n\n\t\treturn group;\n\t}\n\n\tfunction setGroupOptions(group, options) {\n\t\tgroup.setAttribute('style', 'fill:' + options.lineColor + ';');\n\t}\n\n\tfunction drawRect(x, y, width, height, parent) {\n\t\tvar rect = doc.createElementNS(svgns, 'rect');\n\n\t\trect.setAttribute('x', x);\n\t\trect.setAttribute('y', y);\n\t\trect.setAttribute('width', width);\n\t\trect.setAttribute('height', height);\n\n\t\tparent.appendChild(rect);\n\n\t\treturn rect;\n\t}\n}\n\nexport default renderer;\n"],"file":"svg.js"}