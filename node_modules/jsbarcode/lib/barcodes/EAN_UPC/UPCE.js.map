{"version":3,"sources":["../../../src/barcodes/EAN_UPC/UPCE.js"],"names":["EXPANSIONS","PARITIES","UPCE","data","options","isValid","search","middleDigits","upcA","expandToUPCA","text","length","substring","displayValue","fontSize","width","guardHeight","height","textMargin","flat","flatEncoding","guardedEncoding","result","encodeMiddleDigits","push","textAlign","numberSystem","checkDigit","parity","parseInt","Barcode","lastUpcE","expansion","digitIndex","i","c"],"mappings":"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","sourcesContent":["// Encoding documentation:\n// https://en.wikipedia.org/wiki/Universal_Product_Code#Encoding\n//\n// UPC-E documentation:\n// https://en.wikipedia.org/wiki/Universal_Product_Code#UPC-E\n\nimport encode from './encoder';\nimport Barcode from '../Barcode.js';\nimport { checksum } from './UPC.js';\n\nconst EXPANSIONS = [\n\t'XX00000XXX',\n\t'XX10000XXX',\n\t'XX20000XXX',\n\t'XXX00000XX',\n\t'XXXX00000X',\n\t'XXXXX00005',\n\t'XXXXX00006',\n\t'XXXXX00007',\n\t'XXXXX00008',\n\t'XXXXX00009'\n];\n\nconst PARITIES = [\n\t['EEEOOO', 'OOOEEE'],\n\t['EEOEOO', 'OOEOEE'],\n\t['EEOOEO', 'OOEEOE'],\n\t['EEOOOE', 'OOEEEO'],\n\t['EOEEOO', 'OEOOEE'],\n\t['EOOEEO', 'OEEOOE'],\n\t['EOOOEE', 'OEEEOO'],\n\t['EOEOEO', 'OEOEOE'],\n\t['EOEOOE', 'OEOEEO'],\n\t['EOOEOE', 'OEEOEO']\n];\n\nclass UPCE extends Barcode {\n\tconstructor(data, options) {\n\t\t// Code may be 6 or 8 digits;\n\t\t// A 7 digit code is ambiguous as to whether the extra digit\n\t\t// is a UPC-A check or number system digit.\n\t\tsuper(data, options);\n\t\tthis.isValid = false;\n\t\tif (data.search(/^[0-9]{6}$/) !== -1) {\n\t\t\tthis.middleDigits = data;\n\t\t\tthis.upcA = expandToUPCA(data, '0');\n\t\t\tthis.text = options.text || `${this.upcA[0]}${data}${this.upcA[this.upcA.length - 1]}`;\n\t\t\tthis.isValid = true;\n\t\t} else if (data.search(/^[01][0-9]{7}$/) !== -1) {\n\t\t\tthis.middleDigits = data.substring(1, data.length - 1);\n\t\t\tthis.upcA = expandToUPCA(this.middleDigits, data[0]);\n\n\t\t\tif (this.upcA[this.upcA.length - 1] === data[data.length - 1]) {\n\t\t\t\tthis.isValid = true;\n\t\t\t} else {\n\t\t\t\t// checksum mismatch\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.displayValue = options.displayValue;\n\n\t\t// Make sure the font is not bigger than the space between the guard bars\n\t\tif (options.fontSize > options.width * 10) {\n\t\t\tthis.fontSize = options.width * 10;\n\t\t} else {\n\t\t\tthis.fontSize = options.fontSize;\n\t\t}\n\n\t\t// Make the guard bars go down half the way of the text\n\t\tthis.guardHeight = options.height + this.fontSize / 2 + options.textMargin;\n\t}\n\n\tvalid() {\n\t\treturn this.isValid;\n\t}\n\n\tencode() {\n\t\tif (this.options.flat) {\n\t\t\treturn this.flatEncoding();\n\t\t} else {\n\t\t\treturn this.guardedEncoding();\n\t\t}\n\t}\n\n\tflatEncoding() {\n\t\tvar result = '';\n\n\t\tresult += '101';\n\t\tresult += this.encodeMiddleDigits();\n\t\tresult += '010101';\n\n\t\treturn {\n\t\t\tdata: result,\n\t\t\ttext: this.text\n\t\t};\n\t}\n\n\tguardedEncoding() {\n\t\tvar result = [];\n\n\t\t// Add the UPC-A number system digit beneath the quiet zone\n\t\tif (this.displayValue) {\n\t\t\tresult.push({\n\t\t\t\tdata: '00000000',\n\t\t\t\ttext: this.text[0],\n\t\t\t\toptions: { textAlign: 'left', fontSize: this.fontSize }\n\t\t\t});\n\t\t}\n\n\t\t// Add the guard bars\n\t\tresult.push({\n\t\t\tdata: '101',\n\t\t\toptions: { height: this.guardHeight }\n\t\t});\n\n\t\t// Add the 6 UPC-E digits\n\t\tresult.push({\n\t\t\tdata: this.encodeMiddleDigits(),\n\t\t\ttext: this.text.substring(1, 7),\n\t\t\toptions: { fontSize: this.fontSize }\n\t\t});\n\n\t\t// Add the end bits\n\t\tresult.push({\n\t\t\tdata: '010101',\n\t\t\toptions: { height: this.guardHeight }\n\t\t});\n\n\t\t// Add the UPC-A check digit beneath the quiet zone\n\t\tif (this.displayValue) {\n\t\t\tresult.push({\n\t\t\t\tdata: '00000000',\n\t\t\t\ttext: this.text[7],\n\t\t\t\toptions: { textAlign: 'right', fontSize: this.fontSize }\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tencodeMiddleDigits() {\n\t\tconst numberSystem = this.upcA[0];\n\t\tconst checkDigit = this.upcA[this.upcA.length - 1];\n\t\tconst parity = PARITIES[parseInt(checkDigit)][parseInt(numberSystem)];\n\t\treturn encode(this.middleDigits, parity);\n\t}\n}\n\nfunction expandToUPCA(middleDigits, numberSystem) {\n\tconst lastUpcE = parseInt(middleDigits[middleDigits.length - 1]);\n\tconst expansion = EXPANSIONS[lastUpcE];\n\n\tlet result = '';\n\tlet digitIndex = 0;\n\tfor (let i = 0; i < expansion.length; i++) {\n\t\tlet c = expansion[i];\n\t\tif (c === 'X') {\n\t\t\tresult += middleDigits[digitIndex++];\n\t\t} else {\n\t\t\tresult += c;\n\t\t}\n\t}\n\n\tresult = `${numberSystem}${result}`;\n\treturn `${result}${checksum(result)}`;\n}\n\nexport default UPCE;\n"],"file":"UPCE.js"}